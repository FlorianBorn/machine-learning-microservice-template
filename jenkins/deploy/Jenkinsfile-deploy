node {
    stage("checkout") {
        checkout(scm)
    }

    stage("get config variables") {
        config = readYaml(file: "jenkins/config.yaml")
    }
}

node("ansible") {
    stage("setup microk8s") {
        dir("ansible") {
            sh "ansible-playbook main.yaml -i inventory -u ansible --extra-vars 'ansible_ssh_pass=0000'"
        }
    }
}

node {

    stage("Test Deployment") {
        sh "echo Test Deployment"
    }   

}

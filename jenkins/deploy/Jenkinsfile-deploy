node {
    stage("checkout") {
        checkout(scm)
    }

    stage("get config variables") {
        config = readYaml(file: "config.yaml")
    }
}

node("k8s") {

    stage("Deploy to k8s") {
        withEnv(['PATH+EXTRA=/snap/bin']) {
            sh "jenkins/deploy/deployment.sh ${config.production_image_name} ${config.production_image_tag} ${config.repository} ${config.deployment_name}"
        }
    }   
}
